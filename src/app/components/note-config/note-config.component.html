<div class="card bg-base-100 shadow-xl">
  <div class="card-body">
    <div class="flex items-center justify-between mb-4">
      <h3 class="card-title text-lg">
        <i class="bi bi-music-note w-5 h-5"></i>
        Note Configuration
      </h3>

      @if (showDelete()) {
        <button class="btn btn-sm btn-error btn-outline"
                (click)="deleteInstance()"
                title="Delete this note configuration">
          <i class="bi bi-trash w-4 h-4"></i>
        </button>
      }
    </div>

    <!-- Note Display Mode Selection -->
    <div class="mb-4">
      <div class="tabs tabs-boxed">
        <button class="tab"
                [class.tab-active]="noteDisplayMode() === 'common'"
                (click)="setNoteDisplayMode('common')">
          Common
        </button>
        <button class="tab"
                [class.tab-active]="noteDisplayMode() === 'octave'"
                (click)="setNoteDisplayMode('octave')">
          By Octave
        </button>
        <button class="tab"
                [class.tab-active]="noteDisplayMode() === 'all'"
                (click)="setNoteDisplayMode('all')">
          All Notes
        </button>
        <button class="tab"
                [class.tab-active]="noteDisplayMode() === 'drums'"
                (click)="setNoteDisplayMode('drums')">
          Drums
        </button>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      <!-- Note Selection Section -->
      <div class="lg:col-span-2 space-y-4">
        @if (noteDisplayMode() === 'octave') {
          <!-- Octave Selection -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">Octave</span>
            </label>
            <select class="select select-bordered"
                    [value]="selectedOctave()"
                    (change)="setOctave(+$any($event.target).value)">
              @for (octave of availableOctaves; track octave.octave) {
                <option [value]="octave.octave">
                  {{ octave.name }} ({{ octave.range }})
                </option>
              }
            </select>
          </div>
        }

        <!-- Note Selection -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Note</span>
            @if (noteDisplayMode() === 'all' || noteDisplayMode() === 'octave') {
              <button class="btn btn-xs btn-outline" (click)="toggleFlats()">
                {{ useFlats() ? '♯ Sharp' : '♭ Flat' }}
              </button>
            }
          </label>
          <select class="select select-bordered"
                  [value]="selectedNote()"
                  (change)="setNote(+$any($event.target).value)">
            @for (note of availableNotes(); track note.value) {
              <option [value]="note.value">
                {{ note.name }}
                @if (noteDisplayMode() !== 'drums') {
                  <span class="text-xs opacity-60">
                    ({{ note.frequency.toFixed(1) }}Hz)
                  </span>
                }
              </option>
            }
          </select>
        </div>

        <!-- Current Note Info -->
        @if (currentNoteInfo(); as noteInfo) {
          <div class="alert alert-info">
            <div class="text-sm">
              <div class="font-semibold">{{ noteInfo.name }}</div>
              <div class="text-xs opacity-70">
                MIDI {{ noteInfo.value }} • {{ noteInfo.frequency.toFixed(2) }}Hz
                @if (noteInfo.isSharp) {
                  • Sharp/Flat
                }
              </div>
            </div>
          </div>
        }
      </div>

      <!-- Control Parameters -->
      <div class="space-y-4">
        <!-- Velocity -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Velocity</span>
          </label>
          <div class="flex items-center gap-2">
            <input type="range"
                   class="range range-primary flex-1"
                   min="1" max="127"
                   [value]="noteVelocity()"
                   (input)="setVelocity(+$any($event.target).value)">
            <div class="badge badge-primary min-w-[3rem]">{{ noteVelocity() }}</div>
          </div>
        </div>

        <!-- MIDI Channel -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Channel</span>
          </label>
          <div class="flex items-center gap-2">
            <input type="number"
                   class="input input-bordered w-20"
                   min="1" max="16"
                   [value]="selectedChannel() + 1"
                   (input)="setChannel(+$any($event.target).value - 1)">
            <span class="text-sm opacity-70">(1-16)</span>
          </div>
        </div>
      </div>
    </div>

    <div class="card-actions justify-between mt-4">
      <div class="form-control">
        <label class="label cursor-pointer">
          <span class="label-text mr-3">Enable Auto-Trigger</span>
          <input type="checkbox"
                 class="toggle toggle-primary"
                 [checked]="noteEnabled()"
                 (change)="toggleNoteEnabled()">
        </label>
      </div>

      <button class="btn btn-primary" (click)="testNote()">
        <i class="bi bi-play-fill w-4 h-4"></i>
        Test Note
      </button>
    </div>

    <!-- Status indicator -->
    <div class="mt-3 pt-3 border-t border-base-300">
      <div class="text-sm opacity-70">
        <span class="font-medium">Config:</span>
        @if (currentNoteInfo(); as noteInfo) {
          {{ noteInfo.name }} ({{ noteInfo.value }})
        } @else {
          MIDI {{ selectedNote() }}
        }
        • Velocity {{ noteVelocity() }}
        • Channel {{ selectedChannel() + 1 }}
        @if (noteEnabled()) {
          <span class="badge badge-success badge-sm ml-2">AUTO</span>
        } @else {
          <span class="badge badge-ghost badge-sm ml-2">MANUAL</span>
        }
      </div>

      <!-- Mode indicator -->
      <div class="text-xs opacity-50 mt-1">
        Mode: {{ noteDisplayMode() | titlecase }}
        @if (noteDisplayMode() === 'octave') {
          • Octave {{ selectedOctave() }}
        }
        @if (useFlats() && (noteDisplayMode() === 'all' || noteDisplayMode() === 'octave')) {
          • Using Flats
        }
      </div>
    </div>
  </div>
</div>
